# Mark each dataframe to distinguish between 'current' and 'previous' rows
result_df_current['source'] = 'current'
result_df_prev['source'] = 'prev'

# Append dataframes together
combined_df = pd.concat([result_df_current, result_df_prev])

# Group by 'CIF Customer Id' and calculate the differences
def calculate_differences(group):
    if 'current' in group['source'].values:
        current = group[group['source'] == 'current'][['Cat A Money', 'Cat B Money', 'Cat S Money']]
        prev = group[group['source'] == 'prev'][['Cat A Money', 'Cat B Money', 'Cat S Money']]
        # If there is no previous record, fill with zeros to keep current values
        if prev.empty:
            return current
        return current.values - prev.values if not prev.empty else current
    return None

# Apply the calculation and drop the rows where 'source' is not 'current', as well as the 'source' column
result = combined_df.groupby('CIF Customer Id').apply(calculate_differences).reset_index()
result = result[result['source'] == 'current'].drop(columns=['source'])
