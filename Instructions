For Each Cell In ThisWorkbook.Worksheets("Security Apportionment").Range(rangeStr)
    For i = 1 To m
        If Facility(i).LoanName = Cell.Value Then

            Dim rankTxt As String
            Dim rankVal As Long

            rankTxt = Trim$(CStr(Cell.Offset(0, 2).Value))

            Debug.Print "MATCH", "Sec order:", order, "Row:", Cell.Row, _
                        "Facility:", Facility(i).LoanName, "Rank:", rankTxt, _
                        "Pref:", Cell.Offset(0, 3).Value

            If IsNumeric(rankTxt) Then
                rankVal = CLng(rankTxt)
            Else
                rankVal = 0
            End If

            If rankVal >= 1 And rankVal <= 3 Then

                Facility(i).Compoundrate = (1 + irr(i)) ^ ((Security(order).Paymentdate - startdate) / 365)
                Facility(i).RemainosFV = Facility(i).Compoundrate * Facility(i).RemainosPV

                Facility(i).Rank = rankVal

                facRowOrder = facRowOrder + 1
                Facility(i).Weight = facRowOrder

                sumosPV(rankVal) = sumosPV(rankVal) + Facility(i).RemainosPV
                sumosFV(rankVal) = sumosFV(rankVal) + Facility(i).RemainosFV

            Else
                Facility(i).Rank = 0
            End If

            Exit For
        End If
    Next i
Next Cell
