import pandas as pd
from openpyxl import load_workbook

# Load the workbook and select the specified sheet
file_path = "Chemicals2.xlsx"
sheet_name = "Indirect"
wb = load_workbook(file_path)
sheet = wb[sheet_name]

# Convert the sheet to a DataFrame
data = pd.DataFrame(sheet.values)

# Find the last row with a value in column AQ
last_row = data[36].last_valid_index() + 2  # 36 is the zero-based index for AQ (column 37 in 1-based index)

# Drag down the formulas in AR2, AS2, and AT2
for col in ['AR', 'AS', 'AT']:
    cell = sheet[f"{col}2"]
    formula = cell.value
    for row in range(3, last_row + 1):
        sheet[f"{col}{row}"].value = f"={formula[1:].replace('$', '')}".replace("2", str(row))

# Save the workbook
wb.save(file_path)

print(f"Formulas dragged down to row {last_row} in columns AR, AS, and AT.")
