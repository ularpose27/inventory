# Cell 4 — Loading current period sheets (excluding footer “Total” row)

managed_sheet  = _find_sheet(xl_current, ["Managed"])
shadows_sheet  = _find_sheet(xl_current, ["Shadows", "Shadow"])
resolved_sheet = _find_sheet(xl_current, ["Resolved"])

df_managed_raw  = pd.read_excel(CURRENT_PATH, sheet_name=managed_sheet,  header=2)
df_shadows_raw  = pd.read_excel(CURRENT_PATH, sheet_name=shadows_sheet,  header=2)
df_resolved_raw = pd.read_excel(CURRENT_PATH, sheet_name=resolved_sheet, header=2)

def _is_total_row(df: pd.DataFrame) -> pd.Series:
    biz = df.get("Business", pd.Series(index=df.index, dtype="string")).astype("string")
    return biz.str.strip().str.lower().eq("total")

m_total = _is_total_row(df_managed_raw)
s_total = _is_total_row(df_shadows_raw)
r_total = _is_total_row(df_resolved_raw)

df_managed  = df_managed_raw.loc[~m_total].copy()
df_shadows  = df_shadows_raw.loc[~s_total].copy()
df_resolved = df_resolved_raw.loc[~r_total].copy()

print("Total rows removed -> Managed:", int(m_total.sum()), "| Shadows:", int(s_total.sum()), "| Resolved:", int(r_total.sum()))
print("Shapes -> Managed:", df_managed.shape, "| Shadows:", df_shadows.shape, "| Resolved:", df_resolved.shape)
