'========================
' Helper functions for facility ordering
'========================

Private Function NzDbl(ByVal v As Variant) As Double
    If IsError(v) Then
        NzDbl = 0#
    ElseIf IsNumeric(v) Then
        NzDbl = CDbl(v)
    Else
        NzDbl = 0#
    End If
End Function


Private Function GetFacilityOrderMode() As Long
    Dim ans As Variant

    Do
        ans = Application.InputBox( _
            Prompt:="How do you want to order the facilities?" & vbCrLf & vbCrLf & _
                    "1 = Net Outstanding Amount (descending)" & vbCrLf & _
                    "2 = Interest Rate (descending)", _
            Title:="Facility Ordering", _
            Type:=1)

        If ans = False Then
            GetFacilityOrderMode = 1
            Exit Function
        End If

        If ans = 1 Or ans = 2 Then
            GetFacilityOrderMode = CLng(ans)
            Exit Function
        Else
            MsgBox "Please enter 1 or 2 only.", vbExclamation
        End If
    Loop
End Function


Private Function BuildFacilityOrder(ByVal orderMode As Long, ByVal m As Long) As Long()
    Dim idx() As Long
    Dim key() As Double
    Dim i As Long, a As Long, b As Long
    Dim tmpIdx As Long, tmpKey As Double

    ReDim idx(1 To m)
    ReDim key(1 To m)

    For i = 1 To m
        idx(i) = i

        If orderMode = 1 Then
            key(i) = NzDbl(Sheets("Hide - Facility").Range("L" & (1 + i)).Value)
        Else
            key(i) = NzDbl(Sheets("Facility").Range("AK" & (7 + i)).Value)
        End If
    Next i

    For a = 1 To m - 1
        For b = a + 1 To m
            If (key(b) > key(a)) Or _
               ((key(b) = key(a)) And idx(b) < idx(a)) Then

                tmpKey = key(a)
                key(a) = key(b)
                key(b) = tmpKey

                tmpIdx = idx(a)
                idx(a) = idx(b)
                idx(b) = tmpIdx
            End If
        Next b
    Next a

    BuildFacilityOrder = idx
End Function
