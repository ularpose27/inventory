######## Converting dataframe to Table in Excel ########

def convert_sheet_to_table():
    # Use the same output_path you already defined above
    wb = load_workbook(output_path)

    # Pandas wrote df_final to the FIRST sheet (default "Sheet1"),
    # so just grab the active sheet â€“ no messing around with names.
    ws = wb.active

    # Determine range boundaries
    last_row = ws.max_row
    last_col = ws.max_column

    # Example: A1:F101
    ref = f"A1:{get_column_letter(last_col)}{last_row}"

    # Create the Excel table
    table = Table(displayName="CustomerRepository", ref=ref)

    # Minimal styling so Excel recognises it as a proper table
    style = TableStyleInfo(
        name="TableStyleMedium2",
        showFirstColumn=False,
        showLastColumn=False,
        showRowStripes=True,
        showColumnStripes=False,
    )
    table.tableStyleInfo = style

    # Add and save
    ws.add_table(table)
    wb.save(output_path)

# Run it
convert_sheet_to_table()

print("SCU subset created:", df_final.shape[0], "rows")
